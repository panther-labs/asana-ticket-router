# Airplane tasks
See [Panther Notion Airplane docs](https://www.notion.so/pantherlabs/Airplane-0389875e0c7b43eeba1a57dfbfdcce9a)

## Projects

Each project should live in its own directory. `airplane deploy` will package the working directory of the task code.



## Usage

```sh
brew install airplanedev/tap/airplane
```

```sh
# Login
airplane login

airplane auth info

# Create an api key
airplane apikeys create <key-name>

# New task
airplane init --slug-echo

# Deployment
airplane deploy echo.sh
```

## CI / Deployment

All projects listed in the [`projects`](projects) file will be deployed when merged to master.

This is the equivalent of `airplane deploy ${project}`


### Auth

The `AIRPLANE_JWT` token used in the github action was manually generated by:

  - `airplane login`

  - Access the jwt in  `~/.airplane/config`


### Testing Python tasks
From the airplane directory (Python3 must be 3.10 or above! This is what Airplane uses):
1. Setup:
```
python3 -m venv airplane_testing
source airplane_testing/bin/activate
pip install -r requirements.txt
pip install -r test-requirements.txt
```
1. Manual tests: `pytest parentdir/of/airplane/python/task --manual-test`
    1. Mark manual tests with `@pytest.mark.manual_test`
1. Unit tests: `pytest parentdir/of/airplane/python/task`
    1. With coverage: `pytest tests --cov-report html --cov=pyshared/ --cov=v2/pyshared/ --cov=.`
    1. Continuously on every file change: `ptw tests`
1. Manually running tasks: `python -m {task_directory}`, e.g. `python -m productivity.ephemeral_statistics.ephemeral_statistics`
